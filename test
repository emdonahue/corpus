#!/bin/zsh

assert() {
       if [[ "$2" != "$3" ]]; then
       	   echo "Failure: $1\n\tExpected: $3\n\tReceived: $2"
	   ERR=1
       fi
}

function teardown() {
    cd "$DIR"
    rm -f a b
}

CORPUS=$(realpath corpus)
FS=$'\034'
DIR=$(mktemp -d)
trap "rm -rf $DIR" EXIT
cd "$DIR"

AHEAD="${FS}a\n"
BHEAD="${FS}b\n"

echo 'aaa' > a
echo 'bbb' > b
assert 'merge' "$($CORPUS merge a b)" "$(echo "${AHEAD}aaa\n${BHEAD}bbb")"
teardown

echo "${FS}a\naaa\n${FS}b\nbbb" | $CORPUS split
[[ -f a ]]
assert 'split a' $? 0
[[ -f b ]]
assert 'split b' $? 0
assert 'split a contents' "$(cat a)" 'aaa'
assert 'split b contents' "$(cat b)" 'bbb'
teardown

assert 'mwe' "$($CORPUS mwe "a b" "d / e" < <(echo "${FS}a b\na b c d / e"))" "$(echo "${FS}a b\na_b c d_/_e")"

[[ -z "$ERR" ]] && echo "All Tests Pass"
exit "$ERR"


